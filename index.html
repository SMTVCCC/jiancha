<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰˜ç¦ç²¾å¬æ¯”å¯¹ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- é…ç½®Tailwindè‡ªå®šä¹‰é¢œè‰²å’Œå­—ä½“ -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        error: '#EF4444',
                        warning: '#F59E0B',
                        neutral: '#64748B',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .transition-height {
                transition: max-height 0.3s ease-in-out;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans flex flex-col">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-headphones text-primary text-2xl"></i>
                <h1 class="text-[clamp(1.25rem,3vw,1.75rem)] font-bold text-gray-800">æ‰˜ç¦ç²¾å¬æ¯”å¯¹ç³»ç»Ÿ</h1>
            </div>

            <!-- Desktop Menu -->
            <div class="hidden md:flex items-center space-x-6">
                <a href="#" id="help-link" class="text-gray-600 hover:text-primary transition-colors duration-200">
                    <i class="fa fa-question-circle mr-1"></i>ä½¿ç”¨å¸®åŠ©
                </a>
                <a href="#" id="history-link" class="text-gray-600 hover:text-primary transition-colors duration-200">
                    <i class="fa fa-history mr-1"></i>å†å²è®°å½•
                </a>
            </div>

            <!-- Mobile Menu Button -->
            <div class="md:hidden">
                <button id="mobile-menu-btn" class="text-gray-600 hover:text-primary focus:outline-none">
                    <i class="fa fa-bars text-2xl"></i>
                </button>
            </div>
        </div>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-200">
            <a href="#" id="mobile-help-link" class="block py-3 px-4 text-gray-600 hover:bg-gray-50 hover:text-primary">
                <i class="fa fa-question-circle mr-2"></i>ä½¿ç”¨å¸®åŠ©
            </a>
            <a href="#" id="mobile-history-link" class="block py-3 px-4 text-gray-600 hover:bg-gray-50 hover:text-primary">
                <i class="fa fa-history mr-2"></i>å†å²è®°å½•
            </a>
        </div>
    </header>

    <!-- ä¸»è¦å†…å®¹åŒº -->
    <main class="container mx-auto px-4 py-8 flex-grow">
        <!-- ä»‹ç»å¡ç‰‡ -->
        <div id="instruction-card" class="bg-white rounded-xl shadow-lg p-6 mb-8 transform hover:shadow-xl transition-shadow duration-300 hidden">
            <div class="flex justify-between items-center mb-3">
                <h2 class="text-xl font-semibold text-gray-800 flex items-center">
                    <i class="fa fa-info-circle text-primary mr-2"></i>ä½¿ç”¨è¯´æ˜
                </h2>
                <button id="close-instruction-btn" class="text-gray-500 hover:text-gray-800">
                    <i class="fa fa-times text-2xl"></i>
                </button>
            </div>
            <div class="space-y-6">
                <!-- åŸºæœ¬ä½¿ç”¨ -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                        <i class="fa fa-play-circle text-primary mr-2"></i>åŸºæœ¬ä½¿ç”¨
                    </h3>
                    <p class="text-gray-600 mb-3">
                        å·¦ä¾§è¾“å…¥æ‚¨å¬å†™çš„å†…å®¹ï¼Œå³ä¾§è¾“å…¥å¬åŠ›åŸæ–‡ï¼Œç‚¹å‡»"å¼€å§‹æ¯”å¯¹"æŒ‰é’®å³å¯æŸ¥çœ‹ç»“æœã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨æ ‡è®°ï¼š
                    </p>
                    <ul class="list-disc list-inside text-gray-600 space-y-1 ml-4">
                        <li><span class="text-error font-medium">çº¢è‰²æ–‡å­—</span>ï¼šæ‹¼å†™é”™è¯¯æˆ–é—æ¼çš„å†…å®¹</li>
                        <li><span class="line-through text-neutral">åˆ é™¤çº¿æ–‡å­—</span>ï¼šå¤šå‡ºæ¥çš„å†…å®¹</li>
                        <li><span class="text-gray-800">æ­£å¸¸æ–‡å­—</span>ï¼šæ­£ç¡®åŒ¹é…çš„å†…å®¹</li>
                        <li><span class="text-blue-600 font-medium">è“è‰²æ–‡å­—</span>ï¼šæ­£ç¡®çš„æ ‡ç‚¹ç¬¦å·</li>
                        <li><span class="text-orange-500 bg-orange-50 px-1 rounded">æ©™è‰²èƒŒæ™¯</span>ï¼šç¼ºå¤±çš„æ ‡ç‚¹ç¬¦å·ï¼ˆä¸è®¡é”™è¯¯ï¼‰</li>
                        <li><span class="text-purple-600 bg-purple-50 px-1 rounded">ç´«è‰²èƒŒæ™¯</span>ï¼šé”™è¯¯çš„æ ‡ç‚¹ç¬¦å·ï¼ˆä¸è®¡é”™è¯¯ï¼‰</li>
                        <li><span class="text-cyan-600 bg-cyan-50 px-1 rounded">é’è‰²èƒŒæ™¯</span>ï¼šå¤šä½™çš„æ ‡ç‚¹ç¬¦å·ï¼ˆä¸è®¡é”™è¯¯ï¼‰</li>
                    </ul>
                </div>

                <!-- åŠŸèƒ½ä»‹ç» -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                        <i class="fa fa-cogs text-secondary mr-2"></i>åŠŸèƒ½ä»‹ç»
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-blue-50 p-3 rounded-lg border border-blue-100">
                            <h4 class="font-medium text-blue-800 mb-2 flex items-center">
                                <i class="fa fa-download mr-2"></i>å¯¼å‡ºTXTæŠ¥å‘Š
                            </h4>
                            <p class="text-sm text-blue-700">å°†æ¯”å¯¹ç»“æœã€ç»Ÿè®¡ä¿¡æ¯å’ŒAIè¯„è¯­å¯¼å‡ºä¸ºTXTæ–‡ä»¶ï¼Œæ–¹ä¾¿ä¿å­˜å’Œåˆ†äº«ã€‚</p>
                        </div>
                        <div class="bg-purple-50 p-3 rounded-lg border border-purple-100">
                            <h4 class="font-medium text-purple-800 mb-2 flex items-center">
                                <i class="fa fa-camera mr-2"></i>æˆªå›¾ä¸‹è½½
                            </h4>
                            <p class="text-sm text-purple-700">ä¸€é”®æˆªå›¾ä¿å­˜æ¯”å¯¹è¯¦æƒ…åŒºåŸŸï¼ŒåŒ…å«ç»Ÿè®¡æ•°æ®ã€æ¯”å¯¹ç»“æœå’Œé”™è¯¯åˆ†æå›¾è¡¨ã€‚</p>
                        </div>
                        <div class="bg-green-50 p-3 rounded-lg border border-green-100">
                            <h4 class="font-medium text-green-800 mb-2 flex items-center">
                                <i class="fa fa-copy mr-2"></i>å¤åˆ¶åŠŸèƒ½
                            </h4>
                            <p class="text-sm text-green-700">å¿«é€Ÿå¤åˆ¶æ¯”å¯¹ç»“æœã€ç»Ÿè®¡ä¿¡æ¯æˆ–AIè¯„è¯­åˆ°å‰ªè´´æ¿ã€‚</p>
                        </div>
                        <div class="bg-orange-50 p-3 rounded-lg border border-orange-100">
                            <h4 class="font-medium text-orange-800 mb-2 flex items-center">
                                <i class="fa fa-robot mr-2"></i>AIæ™ºèƒ½è¯„è¯­
                            </h4>
                            <p class="text-sm text-orange-700">åŸºäºæ‚¨çš„å¬å†™è¡¨ç°ï¼ŒAIä¼šæä¾›ä¸ªæ€§åŒ–çš„å­¦ä¹ å»ºè®®å’Œæ”¹è¿›æ–¹æ¡ˆã€‚</p>
                        </div>
                    </div>
                </div>

                <!-- AIè¯„è¯­è¯¦ç»†è¯´æ˜ -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                        <i class="fa fa-magic text-purple-600 mr-2"></i>AIè¯„è¯­åŠŸèƒ½
                    </h3>
                    <div class="bg-gradient-to-r from-purple-50 to-blue-50 p-4 rounded-lg border border-purple-100">
                        <p class="text-gray-700 mb-3">
                            AIè¯„è¯­åŠŸèƒ½ç”±<strong>ç§‘å¤§è®¯é£æ˜Ÿç«å¤§æ¨¡å‹</strong>é©±åŠ¨ï¼Œä¸ºæ‚¨æä¾›ä¸“ä¸šçš„å¬å†™åˆ†æï¼š
                        </p>
                        <ul class="list-disc list-inside text-gray-600 space-y-2 ml-4">
                            <li><strong>æ•´ä½“è¡¨ç°è¯„ä»·</strong>ï¼šåŸºäºå‡†ç¡®ç‡å’Œé”™è¯¯ç±»å‹ç»™å‡ºç»¼åˆè¯„ä»·</li>
                            <li><strong>å…·ä½“é—®é¢˜åˆ†æ</strong>ï¼šè¯†åˆ«æ‚¨åœ¨å¬å†™ä¸­çš„ä¸»è¦é—®é¢˜å’Œè–„å¼±ç¯èŠ‚</li>
                            <li><strong>æ”¹è¿›å»ºè®®</strong>ï¼šæä¾›é’ˆå¯¹æ€§çš„å­¦ä¹ å»ºè®®å’Œç»ƒä¹ æ–¹æ³•</li>
                            <li><strong>ä¸ªæ€§åŒ–æŒ‡å¯¼</strong>ï¼šæ ¹æ®æ‚¨çš„é”™è¯¯æ¨¡å¼å®šåˆ¶ä¸“å±å­¦ä¹ æ–¹æ¡ˆ</li>
                        </ul>
                        <div class="mt-3 p-3 bg-white rounded border border-purple-200">
                            <p class="text-sm text-purple-700">
                                <i class="fa fa-magic mr-1"></i>
                                <strong>è‡ªåŠ¨ç”Ÿæˆï¼š</strong>å®Œæˆæ¯”å¯¹åï¼ŒAIå°†è‡ªåŠ¨åˆ†ææ‚¨çš„å¬å†™æ•°æ®å¹¶ç”Ÿæˆä¸“ä¸šè¯„è¯­ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œã€‚
                            </p>
                            <p class="text-sm text-purple-600 mt-2">
                                <i class="fa fa-lightbulb mr-1"></i>
                                <strong>æ‰‹åŠ¨é‡æ–°ç”Ÿæˆï¼š</strong>å¦‚éœ€é‡æ–°ç”Ÿæˆè¯„è¯­ï¼Œå¯ç‚¹å‡»"ç”ŸæˆAIè¯„è¯­"æŒ‰é’®ã€‚
                            </p>
                        </div>
                    </div>
                </div>

                <!-- å¿«æ·é”®è¯´æ˜ -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                        <i class="fa fa-keyboard-o text-warning mr-2"></i>å¿«æ·é”®
                    </h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                            <span class="text-gray-700">å¼€å§‹æ¯”å¯¹</span>
                            <kbd class="px-2 py-1 bg-gray-200 rounded text-sm">Ctrl+Enter</kbd>
                        </div>
                        <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                            <span class="text-gray-700">å¤åˆ¶ç»“æœ</span>
                            <kbd class="px-2 py-1 bg-gray-200 rounded text-sm">Ctrl+Shift+C</kbd>
                        </div>
                        <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                            <span class="text-gray-700">å¯¼å‡ºTXT</span>
                            <kbd class="px-2 py-1 bg-gray-200 rounded text-sm">Ctrl+Shift+E</kbd>
                        </div>
                        <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                            <span class="text-gray-700">æˆªå›¾ä¸‹è½½</span>
                            <kbd class="px-2 py-1 bg-gray-200 rounded text-sm">Ctrl+Shift+S</kbd>
                        </div>
                        <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                            <span class="text-gray-700">æ¸…ç©ºå†…å®¹</span>
                            <kbd class="px-2 py-1 bg-gray-200 rounded text-sm">Escape</kbd>
                        </div>
                    </div>
                    <p class="text-sm text-gray-500 mt-2">
                        <i class="fa fa-apple mr-1"></i>Macç”¨æˆ·è¯·ä½¿ç”¨Cmdé”®æ›¿ä»£Ctrlé”®
                    </p>
                </div>
            </div>
            

        </div>
        
        <!-- è¾“å…¥åŒºåŸŸ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- å·¦ä¾§ï¼šç”¨æˆ·å¬å†™å†…å®¹ -->
            <div class="bg-white rounded-xl shadow-md p-5 transition-all duration-300 hover:shadow-lg">
                <label for="user-text" class="block text-lg font-medium text-gray-800 mb-3 flex items-center">
                    <i class="fa fa-pencil-square-o text-primary mr-2"></i>æ‚¨çš„å¬å†™å†…å®¹
                </label>
                <div class="relative">
                    <textarea 
                        id="user-text" 
                        class="w-full min-h-[12rem] max-h-[32rem] p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-200 resize-none overflow-y-auto"
                        placeholder="è¯·åœ¨æ­¤è¾“å…¥æ‚¨å¬å†™çš„å†…å®¹..."></textarea>
                    <div class="absolute bottom-3 right-3 text-sm text-gray-500">
                        <span id="user-word-count">0</span> ä¸ªå­—
                    </div>
                </div>
            </div>
            
            <!-- å³ä¾§ï¼šå¬åŠ›åŸæ–‡ -->
            <div class="bg-white rounded-xl shadow-md p-5 transition-all duration-300 hover:shadow-lg">
                <label for="original-text" class="block text-lg font-medium text-gray-800 mb-3 flex items-center">
                    <i class="fa fa-file-text-o text-secondary mr-2"></i>å¬åŠ›åŸæ–‡
                </label>
                <div class="relative">
                    <textarea 
                        id="original-text" 
                        class="w-full min-h-[12rem] max-h-[32rem] p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary/50 focus:border-secondary transition-all duration-200 resize-none overflow-y-auto"
                        placeholder="è¯·åœ¨æ­¤è¾“å…¥å¬åŠ›åŸæ–‡..."></textarea>
                    <div class="absolute bottom-3 right-3 text-sm text-gray-500">
                        <span id="original-word-count">0</span> ä¸ªå­—
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ“ä½œæŒ‰é’® -->
        <div class="flex flex-col sm:flex-row gap-3 justify-center mb-8 flex-wrap">
            <button 
                id="compare-btn" 
                class="bg-primary hover:bg-primary/90 text-white font-medium py-3 px-6 sm:px-8 rounded-full shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed min-w-[140px]"
                disabled>
                <i class="fa fa-exchange mr-2"></i>å¼€å§‹æ¯”å¯¹
            </button>
            <button 
                id="clear-btn" 
                class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-3 px-6 sm:px-8 rounded-full shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center min-w-[140px]">
                <i class="fa fa-trash mr-2"></i>æ¸…ç©ºå†…å®¹
            </button>
            <button 
                id="export-btn" 
                class="bg-secondary hover:bg-secondary/90 text-white font-medium py-3 px-6 sm:px-8 rounded-full shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed hidden min-w-[140px]"
                disabled>
                <i class="fa fa-download mr-2"></i>å¯¼å‡ºTXT
            </button>
            <button 
                id="screenshot-btn" 
                class="bg-purple-500 hover:bg-purple-600 text-white font-medium py-3 px-6 sm:px-8 rounded-full shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed hidden min-w-[140px]"
                disabled>
                <i class="fa fa-camera mr-2"></i>æˆªå›¾ä¸‹è½½
            </button>
            <button 
                id="copy-btn" 
                class="bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-6 sm:px-8 rounded-full shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed hidden min-w-[140px]"
                disabled>
                <i class="fa fa-copy mr-2"></i>å¤åˆ¶ç»“æœ
            </button>
        </div>
        
        <!-- æ¯”å¯¹ç»“æœ -->
        <div id="result-section" class="bg-white rounded-xl shadow-md p-6 mb-8 hidden">
            <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                <i class="fa fa-bar-chart text-warning mr-2"></i>æ¯”å¯¹ç»“æœ
            </h2>
            
            <!-- ç»Ÿè®¡ä¿¡æ¯ -->
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                    <p class="text-sm text-gray-500 mb-1">æ€»å­—æ•°ï¼ˆåŸæ–‡ï¼‰</p>
                    <p id="stat-original-total" class="text-2xl font-bold text-primary">0</p>
                </div>
                <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                    <p class="text-sm text-gray-500 mb-1">æ­£ç¡®å­—æ•°</p>
                    <p id="stat-correct" class="text-2xl font-bold text-secondary">0</p>
                </div>
                <div class="bg-red-50 p-4 rounded-lg border border-red-100">
                    <p class="text-sm text-gray-500 mb-1">é”™è¯¯/é—æ¼å­—æ•°</p>
                    <p id="stat-errors" class="text-2xl font-bold text-error">0</p>
                </div>
                <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-100">
                    <p class="text-sm text-gray-500 mb-1">å¤šä½™å­—æ•°</p>
                    <p id="stat-extra" class="text-2xl font-bold text-warning">0</p>
                </div>
            </div>
            
            <!-- æ¯”å¯¹è¯¦æƒ… -->
            <div class="border-t border-gray-200 pt-4">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-lg font-medium text-gray-700">æ¯”å¯¹è¯¦æƒ…</h3>
                    <div class="flex flex-col sm:flex-row gap-2">
                        <button id="copy-comparison-btn" class="text-sm bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-md transition-colors duration-200 flex items-center justify-center">
                            <i class="fa fa-copy mr-1"></i><span class="hidden sm:inline">å¤åˆ¶æ¯”å¯¹ç»“æœ</span><span class="sm:hidden">å¤åˆ¶æ¯”å¯¹</span>
                        </button>
                        <button id="copy-stats-btn" class="text-sm bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-md transition-colors duration-200 flex items-center justify-center">
                            <i class="fa fa-chart-bar mr-1"></i><span class="hidden sm:inline">å¤åˆ¶ç»Ÿè®¡ä¿¡æ¯</span><span class="sm:hidden">å¤åˆ¶ç»Ÿè®¡</span>
                        </button>
                    </div>
                </div>
                <div id="comparison-result" class="p-4 bg-gray-50 rounded-lg min-h-[100px] whitespace-pre-wrap leading-relaxed"></div>
            </div>
        </div>
        
        <!-- åˆ†ææŠ¥å‘Š -->
        <div id="analysis-section" class="bg-white rounded-xl shadow-md p-6 hidden">
            <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                <i class="fa fa-line-chart text-primary mr-2"></i>é”™è¯¯åˆ†æ
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- é”™è¯¯ç±»å‹åˆ†å¸ƒ -->
                <div>
                    <h3 class="text-lg font-medium text-gray-700 mb-3">é”™è¯¯ç±»å‹åˆ†å¸ƒ</h3>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <canvas id="error-type-chart"></canvas>
                    </div>
                </div>
                
                <!-- å¸¸è§é”™è¯¯å•è¯ -->
                <div>
                    <h3 class="text-lg font-medium text-gray-700 mb-3">å¸¸è§é”™è¯¯å•è¯</h3>
                    <div class="bg-gray-50 p-4 rounded-lg max-h-[300px] overflow-y-auto">
                        <ul id="common-errors" class="space-y-2">
                            <!-- åŠ¨æ€å¡«å…… -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- AIè¯„è¯­åŒºåŸŸ -->
        <div id="ai-comment-section" class="bg-white rounded-xl shadow-md p-6 mb-8 hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-gray-800 flex items-center">
                    <i class="fa fa-robot text-purple-600 mr-2"></i>AIæ™ºèƒ½è¯„è¯­
                </h2>
                <button 
                    id="generate-ai-comment-btn" 
                    class="bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 flex items-center disabled:opacity-50 disabled:cursor-not-allowed"
                    disabled>
                    <i class="fa fa-magic mr-2"></i>ç”ŸæˆAIè¯„è¯­
                </button>
            </div>
            
            <div id="ai-comment-content" class="bg-gradient-to-r from-purple-50 to-blue-50 p-4 rounded-lg min-h-[120px] border border-purple-100">
                <div id="ai-comment-loading" class="hidden flex items-center justify-center py-8">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mr-3"></div>
                    <span class="text-purple-600 font-medium">AIæ­£åœ¨åˆ†ææ‚¨çš„å¬å†™æƒ…å†µ...</span>
                </div>
                <div id="ai-comment-text" class="text-gray-600 leading-relaxed whitespace-pre-wrap">
                    ç‚¹å‡»"ç”ŸæˆAIè¯„è¯­"æŒ‰é’®ï¼Œè®©AIä¸ºæ‚¨çš„å¬å†™è¡¨ç°æä¾›ä¸“ä¸šçš„åˆ†æå’Œå»ºè®®ã€‚
                </div>
            </div>
            
            <div class="flex justify-end mt-4 space-x-3">
                <button 
                    id="copy-ai-comment-btn" 
                    class="bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 flex items-center disabled:opacity-50 disabled:cursor-not-allowed hidden"
                    disabled>
                    <i class="fa fa-copy mr-2"></i>å¤åˆ¶è¯„è¯­
                </button>
            </div>
        </div>
    </main>

    <!-- é¡µè„š -->
    <footer class="bg-gray-800 text-white py-8 mt-auto">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <div class="flex items-center justify-center md:justify-start">
                        <i class="fa fa-headphones text-primary text-xl mr-2"></i>
                        <span class="font-bold text-lg">æ‰˜ç¦ç²¾å¬æ¯”å¯¹ç³»ç»Ÿ</span>
                    </div>
                    <p class="text-gray-400 text-sm mt-2 text-center md:text-left">åŠ©åŠ›æ‰˜ç¦å¬åŠ›ç»ƒä¹ ï¼Œæå‡å¬å†™å‡†ç¡®æ€§</p>
                </div>
                
                <div class="flex space-x-6">
                    <a href="#" class="text-gray-400 hover:text-white transition-colors duration-200">
                        <i class="fa fa-question-circle"></i> å¸®åŠ©ä¸­å¿ƒ
                    </a>
                    <a href="#" id="contact-us-link" class="text-gray-400 hover:text-white transition-colors duration-200">
                        <i class="fa fa-envelope"></i> è”ç³»æˆ‘ä»¬
                    </a>
                </div>
            </div>
            
            <div class="border-t border-gray-700 mt-6 pt-6 text-center text-gray-400 text-sm">
                &copy;2025 SMT_Vincentï½œæ‰€æœ‰æƒä¿ç•™
            </div>
        </div>
    </footer>

    <!-- å¼•å…¥Chart.jsç”¨äºæ•°æ®å¯è§†åŒ– -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    
    <!-- å¼•å…¥CryptoJSç”¨äºAPIè®¤è¯ -->
    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.js"></script>
    
    <!-- å¼•å…¥html2canvasç”¨äºæˆªå›¾åŠŸèƒ½ -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    
    <!-- å¼•å…¥æ˜Ÿç«APIæ¨¡å— -->
    <script src="spark-api.js"></script>
    <script src="init-spark.js"></script>
    
    <!-- ä¸»è„šæœ¬ -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // è·å–DOMå…ƒç´ 
            const userText = document.getElementById('user-text');
            const originalText = document.getElementById('original-text');
            const compareBtn = document.getElementById('compare-btn');
            const clearBtn = document.getElementById('clear-btn');
            const resultSection = document.getElementById('result-section');
            const analysisSection = document.getElementById('analysis-section');
            const comparisonResult = document.getElementById('comparison-result');
            const userWordCount = document.getElementById('user-word-count');
            const originalWordCount = document.getElementById('original-word-count');
            const helpLink = document.getElementById('help-link');
            const instructionCard = document.getElementById('instruction-card');
            const closeInstructionBtn = document.getElementById('close-instruction-btn');
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            const mobileHelpLink = document.getElementById('mobile-help-link');
            const exportBtn = document.getElementById('export-btn');
            const screenshotBtn = document.getElementById('screenshot-btn');
            const copyBtn = document.getElementById('copy-btn');
            const copyComparisonBtn = document.getElementById('copy-comparison-btn');
            const copyStatsBtn = document.getElementById('copy-stats-btn');
            const aiCommentSection = document.getElementById('ai-comment-section');
            const generateAiCommentBtn = document.getElementById('generate-ai-comment-btn');
            const aiCommentLoading = document.getElementById('ai-comment-loading');
            const aiCommentText = document.getElementById('ai-comment-text');
            const copyAiCommentBtn = document.getElementById('copy-ai-comment-btn');
            const contactUsLink = document.getElementById('contact-us-link');
            const historyLink = document.getElementById('history-link');
            const mobileHistoryLink = document.getElementById('mobile-history-link');

            // æ¡Œé¢ç«¯å¸®åŠ©é“¾æ¥
            helpLink.addEventListener('click', function(e) {
                e.preventDefault();
                instructionCard.classList.toggle('hidden');
            });

            // ç§»åŠ¨ç«¯å¸®åŠ©é“¾æ¥
            mobileHelpLink.addEventListener('click', function(e) {
                e.preventDefault();
                instructionCard.classList.toggle('hidden');
                mobileMenu.classList.add('hidden');
            });

            // å…³é—­è¯´æ˜æŒ‰é’®
            closeInstructionBtn.addEventListener('click', function() {
                instructionCard.classList.add('hidden');
            });

            // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
            mobileMenuBtn.addEventListener('click', function() {
                mobileMenu.classList.toggle('hidden');
            });

            // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­ç§»åŠ¨ç«¯èœå•
            document.addEventListener('click', function(e) {
                if (!mobileMenuBtn.contains(e.target) && !mobileMenu.contains(e.target)) {
                    mobileMenu.classList.add('hidden');
                }
            });

            // å¯¼å‡ºåŠŸèƒ½
            exportBtn.addEventListener('click', function() {
                exportResults();
            });
            
            // æˆªå›¾åŠŸèƒ½
            screenshotBtn.addEventListener('click', function() {
                captureAndDownloadScreenshot();
            });
            
            // å¤åˆ¶åŠŸèƒ½
            copyBtn.addEventListener('click', function() {
                copyAllResults();
            });
            
            // å¤åˆ¶æ¯”å¯¹ç»“æœ
            copyComparisonBtn.addEventListener('click', function() {
                copyComparisonResults();
            });
            
            // å¤åˆ¶ç»Ÿè®¡ä¿¡æ¯
            copyStatsBtn.addEventListener('click', function() {
                copyStatistics();
            });
            
            // ç”ŸæˆAIè¯„è¯­
            generateAiCommentBtn.addEventListener('click', function() {
                generateAIComment();
            });
            
            // å¤åˆ¶AIè¯„è¯­
            copyAiCommentBtn.addEventListener('click', function() {
                copyAIComment();
            });
            
            // è”ç³»æˆ‘ä»¬åŠŸèƒ½
            contactUsLink.addEventListener('click', function(e) {
                e.preventDefault();
                showEmailContact();
            });
            
            // å†å²è®°å½•åŠŸèƒ½ï¼ˆæ¡Œé¢ç«¯ï¼‰
            historyLink.addEventListener('click', function(e) {
                e.preventDefault();
                showHistoryFeature();
            });
            
            // å†å²è®°å½•åŠŸèƒ½ï¼ˆç§»åŠ¨ç«¯ï¼‰
            mobileHistoryLink.addEventListener('click', function(e) {
                e.preventDefault();
                showHistoryFeature();
                mobileMenu.classList.add('hidden');
            });
            
            // ç»Ÿè®¡ä¿¡æ¯å…ƒç´ 
            const statOriginalTotal = document.getElementById('stat-original-total');
            const statCorrect = document.getElementById('stat-correct');
            const statErrors = document.getElementById('stat-errors');
            const statExtra = document.getElementById('stat-extra');
            
            // å¸¸è§é”™è¯¯å•è¯åˆ—è¡¨
            const commonErrorsList = document.getElementById('common-errors');
            
            // è‡ªåŠ¨è°ƒæ•´æ–‡æœ¬æ¡†é«˜åº¦çš„å‡½æ•°
            function autoResize(textarea) {
                 textarea.style.height = 'auto';
                 const minHeight = 192; // 12rem = 192px
                 const maxHeight = 512; // 32rem = 512px
                 const newHeight = Math.min(Math.max(textarea.scrollHeight, minHeight), maxHeight);
                 textarea.style.height = newHeight + 'px';
             }

            // ç›‘å¬æ–‡æœ¬è¾“å…¥ï¼Œæ›´æ–°å­—æ•°ç»Ÿè®¡ã€æŒ‰é’®çŠ¶æ€å’Œè‡ªåŠ¨è°ƒæ•´é«˜åº¦
             [userText, originalText].forEach(textarea => {
                 textarea.addEventListener('input', function() {
                     updateWordCount();
                     autoResize(this);
                 });
                 
                 // åˆå§‹åŒ–é«˜åº¦
                 autoResize(textarea);
             });
            
            // æ›´æ–°å­—æ•°ç»Ÿè®¡
            function updateWordCount() {
                const userCount = userText.value.length;
                const originalCount = originalText.value.length;
                
                userWordCount.textContent = userCount;
                originalWordCount.textContent = originalCount;
                
                // åªæœ‰å½“ä¸¤ä¸ªæ–‡æœ¬æ¡†éƒ½æœ‰å†…å®¹æ—¶æ‰å¯ç”¨æ¯”å¯¹æŒ‰é’®
                compareBtn.disabled = userCount === 0 || originalCount === 0;
            }
            
            // æ¸…ç©ºæŒ‰é’®äº‹ä»¶
            clearBtn.addEventListener('click', function() {
                userText.value = '';
                originalText.value = '';
                updateWordCount();
                resultSection.classList.add('hidden');
                analysisSection.classList.add('hidden');
                aiCommentSection.classList.add('hidden');
                exportBtn.classList.add('hidden');
                exportBtn.disabled = true;
                screenshotBtn.classList.add('hidden');
                screenshotBtn.disabled = true;
                copyBtn.classList.add('hidden');
                copyBtn.disabled = true;
                generateAiCommentBtn.disabled = true;
                copyAiCommentBtn.classList.add('hidden');
                copyAiCommentBtn.disabled = true;
                // é‡ç½®AIè¯„è¯­å†…å®¹
                aiCommentText.textContent = 'ç‚¹å‡»"ç”ŸæˆAIè¯„è¯­"æŒ‰é’®ï¼Œè®©AIä¸ºæ‚¨çš„å¬å†™è¡¨ç°æä¾›ä¸“ä¸šçš„åˆ†æå’Œå»ºè®®ã€‚';
            });
            
            // æ¯”å¯¹æŒ‰é’®äº‹ä»¶
            compareBtn.addEventListener('click', function() {
                const userInput = userText.value;
                const originalInput = originalText.value;
                
                // æ¯”å¯¹æ–‡æœ¬
                const result = compareTexts(userInput, originalInput);
                
                // æ˜¾ç¤ºç»“æœ
                displayResults(result);
                
                // æ˜¾ç¤ºåˆ†æ
                displayAnalysis(result);
                
                // æ˜¾ç¤ºå¯¼å‡ºã€æˆªå›¾å’Œå¤åˆ¶æŒ‰é’®
                exportBtn.classList.remove('hidden');
                exportBtn.disabled = false;
                screenshotBtn.classList.remove('hidden');
                screenshotBtn.disabled = false;
                copyBtn.classList.remove('hidden');
                copyBtn.disabled = false;
                
                // æ˜¾ç¤ºAIè¯„è¯­åŒºåŸŸå¹¶å¯ç”¨ç”ŸæˆæŒ‰é’®
                aiCommentSection.classList.remove('hidden');
                generateAiCommentBtn.disabled = false;
                
                // è‡ªåŠ¨ç”ŸæˆAIè¯„è¯­
                setTimeout(() => {
                    generateAIComment();
                }, 1000); // å»¶è¿Ÿ1ç§’åè‡ªåŠ¨ç”Ÿæˆï¼Œè®©ç”¨æˆ·å…ˆçœ‹åˆ°æ¯”å¯¹ç»“æœ
                
                // é¦–æ¬¡ä½¿ç”¨åè‡ªåŠ¨éšè—ä½¿ç”¨è¯´æ˜
                const hasUsedBefore = localStorage.getItem('toefl-dictation-used');
                if (!hasUsedBefore) {
                    localStorage.setItem('toefl-dictation-used', 'true');
                    // å»¶è¿Ÿ3ç§’åè‡ªåŠ¨éšè—ä½¿ç”¨è¯´æ˜ï¼Œç»™ç”¨æˆ·æ—¶é—´æŸ¥çœ‹ç»“æœ
                    setTimeout(() => {
                        if (!instructionCard.classList.contains('hidden')) {
                            instructionCard.classList.add('hidden');
                            showToast('ä½¿ç”¨è¯´æ˜å·²è‡ªåŠ¨éšè—ï¼Œå¯ç‚¹å‡»å³ä¸Šè§’"ä½¿ç”¨è¯´æ˜"é‡æ–°æŸ¥çœ‹', 'info');
                        }
                    }, 3000);
                }
                
                // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
                resultSection.scrollIntoView({ behavior: 'smooth' });
            });
            
            // æ–‡æœ¬æ¯”å¯¹æ ¸å¿ƒå‡½æ•°
            function compareTexts(userText, originalText) {
                // é¢„å¤„ç†å‡½æ•°ï¼Œç”¨äºç§»é™¤æ¯è¡Œå¼€å¤´çš„ "è®²è¿°äºº: " æ ‡è®°
                const preprocessText = (text) => {
                    if (!text) return '';
                    return text.split('\n').map(line => {
                        // ç§»é™¤å¦‚ "speaker: " æˆ– "speakerï¼š " (ä¸­è‹±æ–‡å†’å·) çš„å‰ç¼€
                        return line.replace(/^[^:\n]*[:ï¼š]\s*/, '');
                    }).join('\n');
                };

                // åˆ¤æ–­æ˜¯å¦ä¸ºæ ‡ç‚¹ç¬¦å·
                const isPunctuation = (token) => {
                    return /^[^\w\s]$/.test(token);
                };

                // å¯¹ä¸¤è¾¹çš„æ–‡æœ¬éƒ½è¿›è¡Œé¢„å¤„ç†
                const processedUserText = preprocessText(userText);
                const processedOriginalText = preprocessText(originalText);

                // åˆ†è¯ - ç®€å•å¤„ç†ï¼ŒæŒ‰ç©ºæ ¼å’Œæ ‡ç‚¹åˆ†å‰²
                const tokenize = (text) => {
                    // ä¿ç•™æ ‡ç‚¹ç¬¦å·ä½œä¸ºç‹¬ç«‹çš„token
                    return text.match(/\w+|[^\w\s]/g) || [];
                };
                
                const userTokens = tokenize(processedUserText);
                const originalTokens = tokenize(processedOriginalText);
                
                // ä½¿ç”¨Levenshteinè·ç¦»ç®—æ³•è¿›è¡Œæ¯”å¯¹
                // åˆ›å»ºçŸ©é˜µ
                const matrix = Array(originalTokens.length + 1)
                    .fill()
                    .map(() => Array(userTokens.length + 1).fill(0));
                
                // åˆå§‹åŒ–çŸ©é˜µ
                for (let i = 0; i <= originalTokens.length; i++) {
                    matrix[i][0] = i;
                }
                for (let j = 0; j <= userTokens.length; j++) {
                    matrix[0][j] = j;
                }
                
                // å¡«å……çŸ©é˜µ
                for (let i = 1; i <= originalTokens.length; i++) {
                    for (let j = 1; j <= userTokens.length; j++) {
                        const cost = originalTokens[i - 1].toLowerCase() === userTokens[j - 1].toLowerCase() ? 0 : 1;
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j] + 1,        // åˆ é™¤
                            matrix[i][j - 1] + 1,        // æ’å…¥
                            matrix[i - 1][j - 1] + cost  // æ›¿æ¢
                        );
                    }
                }
                
                // å›æº¯æ‰¾åˆ°æ¯”å¯¹è·¯å¾„
                let i = originalTokens.length;
                let j = userTokens.length;
                const comparison = [];
                const errors = {
                    spelling: 0,
                    missing: 0,
                    extra: 0,
                    totalOriginal: originalTokens.length,
                    correct: 0,
                    errorWords: []
                };
                
                while (i > 0 || j > 0) {
                    if (i > 0 && j > 0 && originalTokens[i - 1].toLowerCase() === userTokens[j - 1].toLowerCase()) {
                        // åŒ¹é…æˆåŠŸ
                        const token = originalTokens[i - 1];
                        comparison.unshift({
                            type: isPunctuation(token) ? 'punctuation' : 'match',
                            original: originalTokens[i - 1],
                            user: userTokens[j - 1]
                        });
                        errors.correct++;
                        i--;
                        j--;
                    } else if (i > 0 && (j === 0 || matrix[i - 1][j] <= matrix[i][j - 1])) {
                        // åŸæ–‡æœ‰ï¼Œç”¨æˆ·ç¼ºå¤±
                        const token = originalTokens[i - 1];
                        if (isPunctuation(token)) {
                            // æ ‡ç‚¹ç¬¦å·ç¼ºå¤±ï¼Œä¸ç®—é”™è¯¯ï¼Œä½†ç”¨ç‰¹æ®Šæ ·å¼æ˜¾ç¤º
                            comparison.unshift({
                                type: 'punctuation-missing',
                                original: originalTokens[i - 1],
                                user: null
                            });
                        } else {
                            // æ™®é€šå•è¯ç¼ºå¤±
                            comparison.unshift({
                                type: 'missing',
                                original: originalTokens[i - 1],
                                user: null
                            });
                            errors.missing++;
                            errors.errorWords.push({
                                original: originalTokens[i - 1],
                                user: null,
                                type: 'missing'
                            });
                        }
                        i--;
                    } else if (j > 0 && (i === 0 || matrix[i][j - 1] <= matrix[i - 1][j])) {
                        if (i > 0 && matrix[i][j] === matrix[i - 1][j - 1] + 1) {
                            // æ‹¼å†™é”™è¯¯æˆ–æ ‡ç‚¹ç¬¦å·é”™è¯¯
                            const originalToken = originalTokens[i - 1];
                            const userToken = userTokens[j - 1];
                            
                            if (isPunctuation(originalToken) && isPunctuation(userToken)) {
                                // æ ‡ç‚¹ç¬¦å·é”™è¯¯ï¼Œä¸ç®—é”™è¯¯ï¼Œä½†ç”¨ç‰¹æ®Šæ ·å¼æ˜¾ç¤º
                                comparison.unshift({
                                    type: 'punctuation-wrong',
                                    original: originalTokens[i - 1],
                                    user: userTokens[j - 1]
                                });
                            } else if (isPunctuation(originalToken) || isPunctuation(userToken)) {
                                // ä¸€ä¸ªæ˜¯æ ‡ç‚¹ä¸€ä¸ªæ˜¯å•è¯ï¼ŒæŒ‰æ ‡ç‚¹å¤„ç†
                                comparison.unshift({
                                    type: 'punctuation-wrong',
                                    original: originalTokens[i - 1],
                                    user: userTokens[j - 1]
                                });
                            } else {
                                // æ™®é€šæ‹¼å†™é”™è¯¯
                                comparison.unshift({
                                    type: 'spelling',
                                    original: originalTokens[i - 1],
                                    user: userTokens[j - 1]
                                });
                                errors.spelling++;
                                errors.errorWords.push({
                                    original: originalTokens[i - 1],
                                    user: userTokens[j - 1],
                                    type: 'spelling'
                                });
                            }
                            i--;
                            j--;
                        } else {
                            // ç”¨æˆ·å¤šå‡ºæ¥çš„å†…å®¹
                            const userToken = userTokens[j - 1];
                            if (isPunctuation(userToken)) {
                                // å¤šä½™çš„æ ‡ç‚¹ç¬¦å·ï¼Œä¸ç®—é”™è¯¯
                                comparison.unshift({
                                    type: 'punctuation-extra',
                                    original: null,
                                    user: userTokens[j - 1]
                                });
                            } else {
                                // å¤šä½™çš„æ™®é€šå•è¯
                                comparison.unshift({
                                    type: 'extra',
                                    original: null,
                                    user: userTokens[j - 1]
                                });
                                errors.extra++;
                                errors.errorWords.push({
                                    original: null,
                                    user: userTokens[j - 1],
                                    type: 'extra'
                                });
                            }
                            j--;
                        }
                    }
                }
                
                return {
                    comparison,
                    errors
                };
            }
            
            // ç”Ÿæˆç»Ÿè®¡ä¿¡æ¯æ–‡æœ¬
            function generateStatisticsText() {
                const originalTotal = statOriginalTotal.textContent;
                const correct = statCorrect.textContent;
                const errors = statErrors.textContent;
                const extra = statExtra.textContent;
                const accuracy = ((parseInt(correct) / parseInt(originalTotal)) * 100).toFixed(1);
                
                return `ğŸ“Š ç»Ÿè®¡ä¿¡æ¯\n` +
                       `åŸæ–‡æ€»å­—æ•°: ${originalTotal}\n` +
                       `âœ… æ­£ç¡®å­—æ•°: ${correct}\n` +
                       `âŒ é”™è¯¯/é—æ¼å­—æ•°: ${errors}\n` +
                       `â• å¤šä½™å­—æ•°: ${extra}\n` +
                       `ğŸ¯ å‡†ç¡®ç‡: ${accuracy}%`;
            }
            
            // ç”Ÿæˆæ¯”å¯¹ç»“æœæ–‡æœ¬ï¼ˆçº¯æ–‡æœ¬æ ¼å¼ï¼‰
            function generateComparisonText() {
                const comparisonText = comparisonResult.textContent;
                return `ğŸ“ æ¯”å¯¹ç»“æœ\n${comparisonText}`;
            }
            
            // å¤åˆ¶æ‰€æœ‰ç»“æœ
            function copyAllResults() {
                const userInput = userText.value;
                const originalInput = originalText.value;
                const timestamp = new Date().toLocaleString('zh-CN');
                
                const content = `ğŸ§ æ‰˜ç¦ç²¾å¬æ¯”å¯¹ç»“æœ\n` +
                               `â° æ—¶é—´: ${timestamp}\n\n` +
                               generateStatisticsText() + '\n\n' +
                               `ğŸ“– æ‚¨çš„å¬å†™å†…å®¹\n${userInput}\n\n` +
                               `ğŸ“„ å¬åŠ›åŸæ–‡\n${originalInput}\n\n` +
                               generateComparisonText();
                
                copyToClipboard(content, 'å®Œæ•´ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }
            
            // å¤åˆ¶æ¯”å¯¹ç»“æœ
            function copyComparisonResults() {
                const content = generateComparisonText();
                copyToClipboard(content, 'æ¯”å¯¹ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }
            
            // å¤åˆ¶ç»Ÿè®¡ä¿¡æ¯
            function copyStatistics() {
                const content = generateStatisticsText();
                copyToClipboard(content, 'ç»Ÿè®¡ä¿¡æ¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }
            
            // å¤åˆ¶åˆ°å‰ªè´´æ¿çš„é€šç”¨å‡½æ•°
            function copyToClipboard(text, successMessage) {
                navigator.clipboard.writeText(text).then(function() {
                    showToast(successMessage, 'success');
                }).catch(function(err) {
                    // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        showToast(successMessage, 'success');
                    } catch (err) {
                        showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
                    }
                    document.body.removeChild(textArea);
                });
            }
            
            // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
            function showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg text-white font-medium transition-all duration-300 transform translate-x-full`;
                
                // æ ¹æ®ç±»å‹è®¾ç½®èƒŒæ™¯è‰²
                if (type === 'success') {
                    toast.className += ' bg-green-500';
                } else if (type === 'error') {
                    toast.className += ' bg-red-500';
                } else if (type === 'info') {
                    toast.className += ' bg-blue-500';
                }
                
                toast.textContent = message;
                
                document.body.appendChild(toast);
                
                // æ˜¾ç¤ºåŠ¨ç”»
                setTimeout(() => {
                    toast.classList.remove('translate-x-full');
                }, 100);
                
                // éšè—åŠ¨ç”»
                setTimeout(() => {
                    toast.classList.add('translate-x-full');
                    setTimeout(() => {
                        document.body.removeChild(toast);
                    }, 300);
                }, 3000);
            }
            
            // å¯¼å‡ºç»“æœåŠŸèƒ½ï¼ˆTXTæ ¼å¼ï¼‰
            function exportResults() {
                const timestamp = new Date().toLocaleString('zh-CN');
                
                let content = 'ğŸ§ æ‰˜ç¦ç²¾å¬æ¯”å¯¹åˆ†ææŠ¥å‘Š\n';
                content += '=' .repeat(50) + '\n';
                content += `â° ç”Ÿæˆæ—¶é—´: ${timestamp}\n\n`;
                
                // ç»Ÿè®¡ä¿¡æ¯
                content += 'ğŸ“Š ç»Ÿè®¡ä¿¡æ¯\n';
                content += '-'.repeat(30) + '\n';
                content += `åŸæ–‡æ€»å­—æ•°: ${statOriginalTotal.textContent}\n`;
                content += `æ­£ç¡®å­—æ•°: ${statCorrect.textContent}\n`;
                content += `é”™è¯¯/é—æ¼å­—æ•°: ${statErrors.textContent}\n`;
                content += `å¤šä½™å­—æ•°: ${statExtra.textContent}\n`;
                const accuracy = ((parseInt(statCorrect.textContent) / parseInt(statOriginalTotal.textContent)) * 100).toFixed(1);
                content += `å‡†ç¡®ç‡: ${accuracy}%\n\n`;
                
                // AIè¯„è¯­ï¼ˆå¦‚æœæœ‰ï¼‰
                const aiCommentElement = document.getElementById('ai-comment-text');
                if (!aiCommentSection.classList.contains('hidden') && 
                    !copyAiCommentBtn.classList.contains('hidden') && 
                    aiCommentElement.textContent && 
                    !aiCommentElement.textContent.includes('ç‚¹å‡»"ç”ŸæˆAIè¯„è¯­"æŒ‰é’®')) {
                    content += 'ğŸ¤– AIæ™ºèƒ½è¯„è¯­\n';
                    content += '-'.repeat(30) + '\n';
                    content += aiCommentElement.textContent + '\n\n';
                }
                
                content += 'Â© 2025 SMT_Vincentï½œæ‰€æœ‰æƒä¿ç•™\n';
                
                // åˆ›å»ºå¹¶ä¸‹è½½TXTæ–‡ä»¶
                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `æ‰˜ç¦ç²¾å¬æ¯”å¯¹æŠ¥å‘Š_${new Date().toISOString().slice(0, 10)}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showToast('TXTæŠ¥å‘Šå·²å¯¼å‡ºï¼', 'success');
            }
            
            // æˆªå›¾å¹¶ä¸‹è½½åŠŸèƒ½
            function captureAndDownloadScreenshot() {
                // è·å–è¦æˆªå›¾çš„åŒºåŸŸï¼ˆåªæˆªå›¾æ¯”å¯¹è¯¦æƒ…åŒºåŸŸï¼‰
                const captureArea = document.getElementById('result-section');
                
                if (!captureArea || captureArea.classList.contains('hidden')) {
                    showToast('è¯·å…ˆè¿›è¡Œæ¯”å¯¹å†æˆªå›¾', 'error');
                    return;
                }
                
                // æ˜¾ç¤ºåŠ è½½æç¤º
                showToast('æ­£åœ¨ç”Ÿæˆæˆªå›¾...', 'info');
                
                // ä½¿ç”¨html2canvasæˆªå›¾
                html2canvas(captureArea, {
                    backgroundColor: '#ffffff',
                    scale: 2, // æé«˜æ¸…æ™°åº¦
                    useCORS: true,
                    allowTaint: true,
                    scrollX: 0,
                    scrollY: 0
                }).then(canvas => {
                    // åˆ›å»ºä¸‹è½½é“¾æ¥
                    const link = document.createElement('a');
                    link.download = `æ‰˜ç¦ç²¾å¬æ¯”å¯¹è¯¦æƒ…_${new Date().toISOString().slice(0, 10)}.png`;
                    link.href = canvas.toDataURL('image/png');
                    
                    // è§¦å‘ä¸‹è½½
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    showToast('æ¯”å¯¹è¯¦æƒ…æˆªå›¾å·²ä¸‹è½½ï¼', 'success');
                }).catch(error => {
                    console.error('æˆªå›¾å¤±è´¥:', error);
                    showToast('æˆªå›¾å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                });
            }
            
            // æ˜¾ç¤ºæ¯”å¯¹ç»“æœ
            function displayResults(result) {
                // æ¸…ç©ºä¹‹å‰çš„ç»“æœ
                comparisonResult.innerHTML = '';
                
                // æ„å»ºæ¯”å¯¹ç»“æœHTML
                result.comparison.forEach(item => {
                    let span = document.createElement('span');
                    let text;
                    
                    switch (item.type) {
                        case 'match':
                            text = item.user;
                            span.className = 'text-gray-800';
                            break;
                        case 'punctuation':
                            text = item.user;
                            span.className = 'text-blue-600 font-medium';
                            span.title = 'æ ‡ç‚¹ç¬¦å·æ­£ç¡®';
                            break;
                        case 'punctuation-missing':
                            text = item.original;
                            span.className = 'text-orange-500 bg-orange-50 px-1 rounded';
                            span.title = 'ç¼ºå¤±çš„æ ‡ç‚¹ç¬¦å·ï¼ˆä¸è®¡å…¥é”™è¯¯ï¼‰';
                            break;
                        case 'punctuation-wrong':
                            text = item.user;
                            span.className = 'text-purple-600 bg-purple-50 px-1 rounded';
                            span.title = `æ ‡ç‚¹ç¬¦å·å»ºè®®: ${item.original}ï¼ˆä¸è®¡å…¥é”™è¯¯ï¼‰`;
                            break;
                        case 'punctuation-extra':
                            text = item.user;
                            span.className = 'text-cyan-600 bg-cyan-50 px-1 rounded';
                            span.title = 'å¤šä½™çš„æ ‡ç‚¹ç¬¦å·ï¼ˆä¸è®¡å…¥é”™è¯¯ï¼‰';
                            break;
                        case 'missing':
                            text = item.original;
                            span.className = 'text-error font-bold bg-red-50 px-1 rounded';
                            break;
                        case 'spelling':
                            text = item.user;
                            span.className = 'text-error underline decoration-dotted bg-red-50 px-1 rounded';
                            // æ·»åŠ titleæ˜¾ç¤ºæ­£ç¡®å•è¯
                            span.title = `æ­£ç¡®å•è¯: ${item.original}`;
                            break;
                        case 'extra':
                            text = item.user;
                            span.className = 'text-neutral line-through bg-gray-100 px-1 rounded';
                            break;
                    }
                    
                    span.textContent = text;
                    comparisonResult.appendChild(span);
                    
                    // æ·»åŠ ç©ºæ ¼
                    const space = document.createTextNode(' ');
                    comparisonResult.appendChild(space);
                });
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                statOriginalTotal.textContent = result.errors.totalOriginal;
                statCorrect.textContent = result.errors.correct;
                statErrors.textContent = result.errors.spelling + result.errors.missing;
                statExtra.textContent = result.errors.extra;
                
                // æ˜¾ç¤ºç»“æœåŒºåŸŸ
                resultSection.classList.remove('hidden');
            }
            
            // æ˜¾ç¤ºé”™è¯¯åˆ†æ
            function displayAnalysis(result) {
                // æ¸…ç©ºä¹‹å‰çš„åˆ†æ
                commonErrorsList.innerHTML = '';
                
                // æ˜¾ç¤ºå¸¸è§é”™è¯¯å•è¯
                const topErrors = result.errors.errorWords.slice(0, 10); // åªæ˜¾ç¤ºå‰10ä¸ª
                if (topErrors.length > 0) {
                    topErrors.forEach(error => {
                        const li = document.createElement('li');
                        li.className = 'flex flex-col sm:flex-row sm:items-center';
                        
                        if (error.type === 'spelling') {
                            li.innerHTML = `
                                <span class="text-error">æ‚¨å†™çš„: ${error.user}</span>
                                <span class="mx-2 hidden sm:inline">â†’</span>
                                <span class="text-secondary">æ­£ç¡®: ${error.original}</span>
                            `;
                        } else if (error.type === 'missing') {
                            li.innerHTML = `
                                <span class="text-error">é—æ¼: ${error.original}</span>
                            `;
                        } else if (error.type === 'extra') {
                            li.innerHTML = `
                                <span class="text-neutral line-through">å¤šä½™: ${error.user}</span>
                            `;
                        }
                        
                        commonErrorsList.appendChild(li);
                    });
                } else {
                    const li = document.createElement('li');
                    li.textContent = 'æ²¡æœ‰æ£€æµ‹åˆ°é”™è¯¯ï¼Œå¾ˆæ£’ï¼';
                    li.className = 'text-secondary text-center';
                    commonErrorsList.appendChild(li);
                }
                
                // åˆ›å»ºé”™è¯¯ç±»å‹åˆ†å¸ƒå›¾è¡¨
                const ctx = document.getElementById('error-type-chart').getContext('2d');
                
                // å¦‚æœå·²æœ‰å›¾è¡¨ï¼Œå…ˆé”€æ¯
                if (window.errorChart) {
                    window.errorChart.destroy();
                }
                
                window.errorChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['æ‹¼å†™é”™è¯¯', 'é—æ¼å†…å®¹', 'å¤šä½™å†…å®¹'],
                        datasets: [{
                            data: [
                                result.errors.spelling,
                                result.errors.missing,
                                result.errors.extra
                            ],
                            backgroundColor: [
                                '#EF4444', // çº¢è‰² - æ‹¼å†™é”™è¯¯
                                '#F59E0B', // é»„è‰² - é—æ¼
                                '#64748B'  // ç°è‰² - å¤šä½™
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
                
                // æ˜¾ç¤ºåˆ†æåŒºåŸŸ
                analysisSection.classList.remove('hidden');
            }
            
            // é”®ç›˜å¿«æ·é”®æ”¯æŒ
            document.addEventListener('keydown', function(e) {
                // Ctrl+Enter æˆ– Cmd+Enter å¼€å§‹æ¯”å¯¹
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    e.preventDefault();
                    if (!compareBtn.disabled) {
                        compareBtn.click();
                    }
                }
                
                // Ctrl+Shift+C æˆ– Cmd+Shift+C å¤åˆ¶ç»“æœ
                if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'C') {
                    e.preventDefault();
                    if (!copyBtn.disabled) {
                        copyBtn.click();
                    }
                }
                
                // Ctrl+Shift+E æˆ– Cmd+Shift+E å¯¼å‡ºTXT
                if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'E') {
                    e.preventDefault();
                    if (!exportBtn.disabled) {
                        exportBtn.click();
                    }
                }
                
                // Ctrl+Shift+S æˆ– Cmd+Shift+S æˆªå›¾ä¸‹è½½
                if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'S') {
                    e.preventDefault();
                    if (!screenshotBtn.disabled) {
                        screenshotBtn.click();
                    }
                }
                
                // Escape æ¸…ç©ºå†…å®¹
                if (e.key === 'Escape') {
                    e.preventDefault();
                    clearBtn.click();
                }
            });
            
            // æ·»åŠ å¿«æ·é”®æç¤º
            function addKeyboardHints() {
                compareBtn.title = 'å¿«æ·é”®: Ctrl+Enter (Mac: Cmd+Enter)';
                copyBtn.title = 'å¿«æ·é”®: Ctrl+Shift+C (Mac: Cmd+Shift+C)';
                exportBtn.title = 'å¯¼å‡ºTXTæŠ¥å‘Š - å¿«æ·é”®: Ctrl+Shift+E (Mac: Cmd+Shift+E)';
                screenshotBtn.title = 'æˆªå›¾ä¸‹è½½ - å¿«æ·é”®: Ctrl+Shift+S (Mac: Cmd+Shift+S)';
                clearBtn.title = 'å¿«æ·é”®: Escape';
            }
            
            // ç”ŸæˆAIè¯„è¯­åŠŸèƒ½
            function generateAIComment() {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                aiCommentLoading.classList.remove('hidden');
                aiCommentText.classList.add('hidden');
                generateAiCommentBtn.disabled = true;
                
                // è·å–æ¯”å¯¹ç»“æœæ•°æ®
                const originalTotal = parseInt(statOriginalTotal.textContent);
                const correct = parseInt(statCorrect.textContent);
                const errors = parseInt(statErrors.textContent);
                const extra = parseInt(statExtra.textContent);
                const accuracy = ((correct / originalTotal) * 100).toFixed(1);
                
                // æ„å»ºAIåˆ†æçš„prompt
                const prompt = `è¯·ä½œä¸ºä¸€åä¸“ä¸šçš„æ‰˜ç¦å¬åŠ›æ•™å¸ˆï¼Œåˆ†æå­¦ç”Ÿçš„å¬å†™è¡¨ç°å¹¶ç»™å‡ºå»ºè®®ã€‚

å­¦ç”Ÿå¬å†™ç»Ÿè®¡ï¼š
- åŸæ–‡æ€»å­—æ•°ï¼š${originalTotal}
- æ­£ç¡®å­—æ•°ï¼š${correct}
- é”™è¯¯/é—æ¼å­—æ•°ï¼š${errors}
- å¤šä½™å­—æ•°ï¼š${extra}
- å‡†ç¡®ç‡ï¼š${accuracy}%

è¯·ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ç»™å‡ºè¯„ä»·å’Œå»ºè®®ï¼š
1. æ•´ä½“è¡¨ç°è¯„ä»·
2. å…·ä½“é—®é¢˜åˆ†æ
3. æ”¹è¿›å»ºè®®
4. ç»ƒä¹ æ–¹æ³•æ¨è

è¯·ç”¨æ¸©å’Œã€é¼“åŠ±çš„è¯­æ°”ï¼Œç»™å‡ºå…·ä½“å¯è¡Œçš„å»ºè®®ï¼Œå­—æ•°æ§åˆ¶åœ¨200-300å­—ã€‚`;
                
                // è®¾ç½®APIå“åº”å›è°ƒ
                if (window.sparkAPI) {
                    window.sparkAPI.setResponseCallback((message, type, isComplete) => {
                        if (type === 'error') {
                            // é”™è¯¯å¤„ç†
                            aiCommentLoading.classList.add('hidden');
                            aiCommentText.classList.remove('hidden');
                            aiCommentText.textContent = 'æŠ±æ­‰ï¼ŒAIè¯„è¯­ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚é”™è¯¯ä¿¡æ¯ï¼š' + message;
                            generateAiCommentBtn.disabled = false;
                        } else if (type === 'assistant') {
                            // æ˜¾ç¤ºAIå›å¤
                            aiCommentLoading.classList.add('hidden');
                            aiCommentText.classList.remove('hidden');
                            aiCommentText.textContent = message;
                            
                            // å¦‚æœå›å¤å®Œæˆï¼Œå¯ç”¨å¤åˆ¶æŒ‰é’®
                            if (isComplete) {
                                generateAiCommentBtn.disabled = false;
                                copyAiCommentBtn.classList.remove('hidden');
                                copyAiCommentBtn.disabled = false;
                            }
                        }
                    });
                    
                    // å‘é€æ¶ˆæ¯åˆ°AI
                    window.sparkAPI.sendMessage(prompt);
                } else {
                    // APIæœªåˆå§‹åŒ–çš„é”™è¯¯å¤„ç†
                    aiCommentLoading.classList.add('hidden');
                    aiCommentText.classList.remove('hidden');
                    aiCommentText.textContent = 'æŠ±æ­‰ï¼ŒAIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•ã€‚';
                    generateAiCommentBtn.disabled = false;
                }
            }
            
            // å¤åˆ¶AIè¯„è¯­åŠŸèƒ½
            function copyAIComment() {
                const commentText = aiCommentText.textContent;
                const timestamp = new Date().toLocaleString('zh-CN');
                const content = `ğŸ¤– AIæ™ºèƒ½è¯„è¯­\nâ° ç”Ÿæˆæ—¶é—´: ${timestamp}\n\n${commentText}`;
                
                copyToClipboard(content, 'AIè¯„è¯­å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }
            
            // æ˜¾ç¤ºé‚®ç®±è”ç³»ä¿¡æ¯
            function showEmailContact() {
                const email = 'smtoffice@yeah.net';
                
                // åˆ›å»ºæ¨¡æ€æ¡†
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white rounded-lg p-6 max-w-md mx-4 shadow-xl">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                                <i class="fa fa-envelope text-primary mr-2"></i>è”ç³»æˆ‘ä»¬
                            </h3>
                            <button class="close-modal text-gray-500 hover:text-gray-800">
                                <i class="fa fa-times text-xl"></i>
                            </button>
                        </div>
                        <div class="text-center">
                            <p class="text-gray-600 mb-4">å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»æˆ‘ä»¬ï¼š</p>
                            <div class="bg-gray-50 rounded-lg p-4 mb-4">
                                <div class="flex items-center justify-center space-x-2">
                                    <i class="fa fa-envelope text-primary"></i>
                                    <span class="font-mono text-lg">${email}</span>
                                </div>
                            </div>
                            <button class="copy-email-btn bg-primary hover:bg-primary-dark text-white px-6 py-2 rounded-lg transition-colors duration-200 flex items-center justify-center mx-auto">
                                <i class="fa fa-copy mr-2"></i>å¤åˆ¶é‚®ç®±åœ°å€
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // ç»‘å®šäº‹ä»¶
                const closeBtn = modal.querySelector('.close-modal');
                const copyBtn = modal.querySelector('.copy-email-btn');
                
                closeBtn.addEventListener('click', () => {
                    document.body.removeChild(modal);
                });
                
                copyBtn.addEventListener('click', () => {
                    copyToClipboard(email, 'é‚®ç®±åœ°å€å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                    document.body.removeChild(modal);
                });
                
                // ç‚¹å‡»èƒŒæ™¯å…³é—­
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        document.body.removeChild(modal);
                    }
                });
            }
            
            // æ˜¾ç¤ºå†å²è®°å½•åŠŸèƒ½
            function showHistoryFeature() {
                // åˆ›å»ºæ¨¡æ€æ¡†
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white rounded-lg p-6 max-w-md mx-4 shadow-xl">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                                <i class="fa fa-history text-primary mr-2"></i>å†å²è®°å½•
                            </h3>
                            <button class="close-modal text-gray-500 hover:text-gray-800">
                                <i class="fa fa-times text-xl"></i>
                            </button>
                        </div>
                        <div class="text-center">
                            <div class="mb-4">
                                <i class="fa fa-clock-o text-6xl text-gray-300 mb-4"></i>
                                <p class="text-gray-600 mb-4">å†å²è®°å½•åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...</p>
                                <p class="text-sm text-gray-500 mb-4">æœªæ¥ç‰ˆæœ¬å°†æ”¯æŒï¼š</p>
                                <ul class="text-left text-sm text-gray-600 space-y-2">
                                    <li class="flex items-center"><i class="fa fa-check text-green-500 mr-2"></i>ä¿å­˜æ¯”å¯¹å†å²</li>
                                    <li class="flex items-center"><i class="fa fa-check text-green-500 mr-2"></i>æŸ¥çœ‹ç»ƒä¹ è¿›åº¦</li>
                                    <li class="flex items-center"><i class="fa fa-check text-green-500 mr-2"></i>ç»Ÿè®¡åˆ†ææŠ¥å‘Š</li>
                                    <li class="flex items-center"><i class="fa fa-check text-green-500 mr-2"></i>é”™è¯¯è¶‹åŠ¿åˆ†æ</li>
                                </ul>
                            </div>
                            <p class="text-sm text-gray-500 mb-4">å¦‚æœ‰å»ºè®®æˆ–éœ€æ±‚ï¼Œæ¬¢è¿è”ç³»æˆ‘ä»¬ï¼š</p>
                            <button class="contact-btn bg-primary hover:bg-primary-dark text-white px-6 py-2 rounded-lg transition-colors duration-200 flex items-center justify-center mx-auto">
                                <i class="fa fa-envelope mr-2"></i>è”ç³»æˆ‘ä»¬
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // ç»‘å®šäº‹ä»¶
                const closeBtn = modal.querySelector('.close-modal');
                const contactBtn = modal.querySelector('.contact-btn');
                
                closeBtn.addEventListener('click', () => {
                    document.body.removeChild(modal);
                });
                
                contactBtn.addEventListener('click', () => {
                    document.body.removeChild(modal);
                    showEmailContact();
                });
                
                // ç‚¹å‡»èƒŒæ™¯å…³é—­
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        document.body.removeChild(modal);
                    }
                });
            }
            
            // åˆå§‹åŒ–
            updateWordCount();
            addKeyboardHints();
        });
    </script>
</body>
</html>
